<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Form Skrining Remaja</title>

    <!-- Bootstrap & Select2 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container py-5">
      <h2 class="text-center fw-bold text-primary mb-4">
        Form Skrining Remaja
      </h2>

      <div class="card p-4 shadow-sm">
        <!-- Form langsung ditampilkan setelah data selesai dimuat -->
        <form id="formSkrining">
          <div class="mb-3">
            <label class="form-label fw-semibold">Cari Nama</label>
            <select id="nama" class="form-select" required>
              <option value="">Memuat data...</option>
            </select>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Nama</label>
              <input
                type="text"
                id="nama_pasien"
                name="nama_pasien"
                class="form-control"
                required
                readonly
              />
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Tanggal</label>
              <input
                type="date"
                id="tanggal"
                name="tanggal"
                class="form-control"
                required
              />
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">NIK</label>
              <input
                type="text"
                id="nik"
                name="nik"
                class="form-control"
                readonly
              />
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">TB (cm)</label>
              <input
                type="number"
                id="tb"
                name="tb"
                class="form-control"
                readonly
              />
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">BB (kg)</label>
              <input
                type="number"
                id="bb"
                name="bb"
                class="form-control"
                readonly
              />
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">IMT</label>
              <input
                type="number"
                id="imt"
                name="imt"
                step="0.01"
                class="form-control"
                readonly
              />
            </div>
          </div>

          <div class="text-end">
            <button type="submit" class="btn btn-success">
              <i class="bi bi-save"></i> Simpan Data
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      $(document).ready(function () {
        // Set tanggal default hari ini
        const today = new Date().toISOString().split("T")[0];
        $("#tanggal").val(today); // Mengatur tanggal default ke hari ini

        // Inisialisasi Select2 dengan AJAX
        $("#nama").select2({
          theme: "bootstrap-5",
          width: "100%",
          placeholder: "Pilih nama remaja...",
          ajax: {
            url: "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhj5Ag8rTA_8OCFh3jLj94AFE477FxK9FhDAmSIf7jdsS6yUbtmMU5jWV-9lSiyiP_3VZqnq4w2rcs6g1HlLlCo5w193tEsLS-_O4QDz9OnYz7ZP7Z9sSUMjMHtN7WjdEYEPXttUwu0k_NGdtmyOu7Yb7hsM4W87O4V20ZUaJ4RdfEu2WVYWSIJKPR08i8tBBSU2Mq7l9gV0mqev7LwhWDzSPRLMdtexoEUOo3KOByPMVGrkQEQqwIOPzKHii5eDpDppxXht-EdE3Y3ozT3wtR_ahRS9fTQPd3aoN6t&lib=M3x28M-3vN8d84k_BHfIhUSb97Ahjq-sz", // Ganti dengan URL API yang sesuai
            dataType: "json",
            delay: 500, // menunggu 500ms sebelum melakukan request
            processResults: function (data) {
              // Proses data dan tampilkan sebagai opsi
              const options = data.map((item) => ({
                id: item.nama,
                text: item.nama,
                nik: item.nik,
                tb: item.tb,
                bb: item.bb,
                imt: item.imt,
              }));
              return {
                results: options,
              };
            },
          },
        });

        // Ketika nama dipilih, isi NIK, TB, BB, IMT otomatis
        $("#nama").on("select2:select", function (e) {
          const data = e.params.data;
          // Isi data di form
          $("#nama_pasien").val(data.text);
          $("#nik").val(data.nik);
          $("#tb").val(data.tb);
          $("#bb").val(data.bb);
          $("#imt").val(data.imt);
        });
      });
    </script>
  </body>
</html>
